<!DOCTYPE html>
<html layout:decorate="~{layout}">
	<head>
		<meta charset="UTF-8" />
		<script>
			$(document).ready(function() {
				$( function() {
					$("#txtBusca").autocomplete({
						source: "listar/2",
						minLength: 3,
						select: function (event, ui) {
							url = "http://localhost:8080/RegistroClinico/cadastrarpac/" + ui.item.value;
							document.location.href = url;
							return false;
						}
					});
				});
			});
			function muda() {
				$("#dropdownMenu2").text("Prontuário");
				$("#dropdownMenu2").val("1");
				$( function() {
					$("#txtBusca").autocomplete({
						source: "listar/1",
						minLength: 1,
						select: function (event, ui) {
							url = "http://localhost:8080/RegistroClinico/cadastrarpac/" + ui.item.value;
							document.location.href = url;
							return false;
						}
					});
				});
			}
			function muda2() {
				$("#dropdownMenu2").text("Nome");
				$("#dropdownMenu2").val("2");
				$( function() {
					$("#txtBusca").autocomplete({
						source: "listar/2",
						minLength: 3,
						select: function (event, ui) {
							url = "http://localhost:8080/RegistroClinico/cadastrarpac/" + ui.item.value;
							document.location.href = url;
							return false;
						}
					});
				});
			}
		</script>
		<script>
			$(document).ready(function() {
				$(".descricao").each(function() {
					var html = $(this).text();
					if(html.length > 20)
						$(this).text(html.substring(0, 20) + '....');
				});
			});
		</script>
	</head>

	<body>
		<section layout:fragment="corpo">
			<nav class="navbar navbar-expand-lg navbar-light" th:fragment="content">
				<div class="collapse navbar-collapse" id="conteudoNavbarSuportado">
					<div class="dropdown">
						<a class="dropbtn" data-toggle="dropdown" href="#"><i class="fa fa-plus fa-fw"></i>Novo</a>
						<div class="dropdown-content">
							<a href="#">Agendamento</a>
							<a href="/pacientes/cadastrar">Paciente</a>
							<a href="#">Funcionário</a>
							<a href="/convenios/cadastrar">Convênio</a>
							<a href="#">Exame</a>
							<a href="#">Laboratório</a>
						</div>
					</div>
					<div class="btn-group">
						<button type="button" class="btn" id="dropdownMenu2" value="1">Nome</button>
						<button type="button" class="btn dropdown-toggle dropdown-toggle-split" id="dropdownMenu3" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							<span class="sr-only">Toggle Dropdown</span>
						</button>
						<div class="dropdown-menu">
							<button class="dropdown-item" type="button" value="1" onclick="muda2()">Nome</button>
							<button class="dropdown-item" type="button" value="2" onclick="muda()">Prontuário</button>
						</div>
					</div>
					<div id="divBusca">
						<input type="text" id="txtBusca" placeholder="Buscar..." />
						<button id="btn_search" class="btn"><i class="fas fa-search" onclick="busca()"></i></button>
					</div>
					<div class="collapse navbar-collapse justify-content-end login">
						<ul class="navbar-nav">
							<li class="nav-item">
								<a class="mr-4">Bem vindo</a>
							</li>
							<li class="nav-item">
								<a href="#" class="decoration"><i class="fas fa-sign-out-alt"></i> Sair</a>
							</li>
						</ul>
					</div>
				</div>
			</nav>
			
			<div class="container-fluid" style="width: 98%">
				<h3 style="display: inline;">Lista | <strong>Registro Clínico</strong></h3>
				<div class="card" style="margin-top: 25px;">
					<div class="card-body">
						<table class="table table-borderless">
							<thead>
								<th>Prontuário</th>
								<th>Nome</th>
								<th>Descrição do último registro</th>
								<th>Data</th>
								<th>Hora</th>
								<th>Total de registros</th>
							</thead>
							<tbody th:each="r : ${registro}">
								<tr>
									<td><a th:text="${r.rclinico.paciente_id.id}"></a></td>
									<td><a th:href="@{/RegistroClinico/cadastrarpac/{id} (id=${r.rclinico.paciente_id.id}) }" th:text="${r.rclinico.paciente_id.nome}"></a></td>
									<td><a class="descricao" th:text="${r.rclinico.descricao}"></a></td>
									<td><a th:text="${#temporals.format(r.rclinico.data, 'dd/MM/yyyy')}"></a></td>
									<td><a th:text="${r.rclinico.hora}"></a></td>
									<td><a th:text="${r.qntId}"></a></td>
								</tr>
							</tbody>
						</table>
					</div>
					<div th:if="${pagination.totalPages > 0}">
						<nav aria-label="Page navigation example">
							<ul class="pagination justify-content-center">
								<li class="page-item" th:if="${pagination.hasPrevious()}">
									<a class="page-link" th:href="@{/RegistroClinico/buscar(page=1)}">
										<span aria-hidden="true">&laquo;</span><span class="sr-only">Previous</span>
									</a>
								</li>
								<li class="page-item"  th:each="p : ${pageNumbers}" th:classappend="${p==pagination.pageable.pageNumber + 1} ? active">
									<a class="page-link" th:text=${p} th:href="@{/RegistroClinico/buscar(page=${p})}"></a>
								</li>
								<li class="page-item" th:if="${pagination.hasNext()}">
									<a class="page-link" th:href="@{/RegistroClinico/buscar(page=${pagination.totalPages})}">
										<span aria-hidden="true">&raquo;</span><span class="sr-only">Next</span>
									</a>
								</li>
							</ul>
						</nav>
					</div>
				</div>
			</div>
		</section>

	</body>
</html>